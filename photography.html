<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Manas Pandey Photography - Professional photography portfolio with seamless masonry gallery">
    <meta name="keywords" content="Photography, Portfolio, Gallery, Manas Pandey">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Manas Pandey">
    <meta name="publisher" content="Manas Pandey">
    <meta name="language" content="en">
    <meta name="revisit-after" content="7 days">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://manasp21.github.io/photography.html">
    <meta property="og:title" content="Photography | Manas Pandey">
    <meta property="og:description" content="Professional photography portfolio with seamless masonry gallery">
    <meta property="og:image" content="https://manasp21.github.io/assets/og-image.jpg">
    <meta property="og:site_name" content="Manas Pandey">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://manasp21.github.io/photography.html">
    <meta property="twitter:title" content="Photography | Manas Pandey">
    <meta property="twitter:description" content="Professional photography portfolio with seamless masonry gallery">
    <meta property="twitter:image" content="https://manasp21.github.io/assets/og-image.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://manasp21.github.io/photography.html">
    
    <title>Photography | Manas Pandey</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Lato:wght@300;400;500&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://manasp21.github.io/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Photography",
          "item": "https://manasp21.github.io/photography.html"
        }
      ]
    }
    </script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body class="page-photography">
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">Manas Pandey</a>
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="research.html">Research</a></li>
                    <li><a href="projects.html">Projects</a></li>
                    <li><a href="blog/">Blog</a></li>
                    <li><a href="photography.html">Photography</a></li>
                    <li><a href="https://manasp21.github.io/poetry_website/" target="_blank">Poetry</a></li>
                </ul>
                <!-- Mobile menu button -->
                <button class="mobile-menu-button" aria-label="Toggle mobile menu" aria-expanded="false">
                    <div class="hamburger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </button>
            </nav>
        </div>
    </header>

    <!-- Mobile navigation menu -->
    <div class="mobile-nav-menu" aria-hidden="true">
        <ul class="mobile-nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="research.html">Research</a></li>
            <li><a href="projects.html">Projects</a></li>
            <li><a href="blog/">Blog</a></li>
            <li><a href="photography.html">Photography</a></li>
            <li><a href="https://manasp21.github.io/poetry_website/" target="_blank">Poetry</a></li>
        </ul>
    </div>

    <!-- Main Gallery -->
    <main class="page-container">
        <h1 class="page-title">Photography</h1>
        
        <section class="content-section">
            <h2 class="section-title">Gallery</h2>
            <p class="section-description">A collection of moments that flowed through me</p>
            
            <!-- Category Filter -->
            <div class="filter-section">
                <div class="filter-buttons" id="categoryFilters">
                    <button class="filter-btn active" data-category="all">All</button>
                    <!-- Categories will be dynamically loaded here -->
                </div>
            </div>
            
            <div class="content-grid photo-grid" id="photoGrid">
                <!-- Photos will be dynamically loaded here -->
            </div>
        </section>
    </main>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-content">
            <img class="lightbox-image" id="lightboxImage" src="" alt="">
        </div>
        
        <!-- Navigation -->
        <button class="nav-arrow prev" id="prevBtn" title="Previous">‹</button>
        <button class="nav-arrow next" id="nextBtn" title="Next">›</button>
        
        <!-- Close Button -->
        <button class="lightbox-close" id="closeBtn" title="Close">✕</button>
        
        <!-- Caption (appears on hover/delay) -->
        <div class="lightbox-caption" id="lightboxCaption">
            <div class="lightbox-caption-title" id="imageTitle"></div>
            <div class="lightbox-caption-text" id="imageCaption"></div>
            <div class="lightbox-caption-meta" id="imageMetadata"></div>
        </div>
    </div>

    <script>
        // Photography Gallery with File-Based System
        let photos = [];
        let filteredPhotos = [];
        let currentImageIndex = 0;
        let isLightboxOpen = false;
        let currentFilter = 'all';

        // Configuration for supported image formats
        const SUPPORTED_FORMATS = ['jpg', 'jpeg', 'png', 'webp', 'gif'];
        const METADATA_FILE = 'gallery/metadata.json';
        const IMAGE_FOLDER = 'gallery/images/';

        // Initialize gallery
        async function initGallery() {
            try {
                await loadGalleryData();
                createCategoryFilters();
                setupEventListeners();
                filterPhotos('all');
            } catch (error) {
                console.error('Failed to initialize gallery:', error);
                showErrorMessage('Failed to load gallery. Please check the configuration.');
            }
        }

        // Load gallery data from metadata file
        async function loadGalleryData() {
            try {
                const response = await fetch(METADATA_FILE);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const galleryData = await response.json();
                
                // Process and validate gallery data
                photos = galleryData.images.map((item, index) => ({
                    id: item.id || index + 1,
                    filename: item.filename,
                    src: `${IMAGE_FOLDER}${item.filename}`,
                    title: item.title || getFilenameWithoutExtension(item.filename),
                    caption: item.caption || '',
                    metadata: item.metadata || {},
                    categories: item.categories || [],
                    featured: item.featured || false,
                    sortOrder: item.sortOrder || index,
                    aspectRatio: item.aspectRatio || 1.5,
                    dimensions: item.dimensions || { width: 1920, height: 1280 }
                }));

                // Sort photos by sortOrder
                photos.sort((a, b) => a.sortOrder - b.sortOrder);

                // Initialize filtered photos
                filteredPhotos = [...photos];
                
                // Calculate grid spans for masonry layout
                calculateGridSpans();

            } catch (error) {
                console.error('Error loading gallery data:', error);
                // Fallback to existing images if metadata fails
                photos = await scanExistingImages();
            }
        }

        // Fallback: minimal fallback if metadata file is not available
        async function scanExistingImages() {
            console.warn('Metadata file not found, using minimal fallback');
            return [];
        }

        // Get filename without extension
        function getFilenameWithoutExtension(filename) {
            return filename.replace(/\.[^/.]+$/, "").replace(/[_-]/g, ' ');
        }

        // No need for complex grid calculations with CSS masonry
        function calculateGridSpans() {
            // CSS masonry handles layout automatically
            return;
        }

        // Create category filters
        function createCategoryFilters() {
            const filterContainer = document.getElementById('categoryFilters');
            const allCategories = new Set();
            
            // Extract all unique categories
            photos.forEach(photo => {
                if (photo.categories && Array.isArray(photo.categories)) {
                    photo.categories.forEach(category => {
                        allCategories.add(category);
                    });
                }
            });
            
            // Sort categories alphabetically
            const sortedCategories = Array.from(allCategories).sort();
            
            // Add category filter buttons
            sortedCategories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.dataset.category = category;
                button.textContent = category.charAt(0).toUpperCase() + category.slice(1).replace('-', ' ');
                button.addEventListener('click', () => filterPhotos(category));
                filterContainer.appendChild(button);
            });
        }
        
        // Filter photos by category
        function filterPhotos(category) {
            currentFilter = category;
            
            if (category === 'all') {
                filteredPhotos = [...photos];
            } else {
                filteredPhotos = photos.filter(photo => 
                    photo.categories && photo.categories.includes(category)
                );
            }
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });
            
            createPhotoGrid();
        }

        // Create photo grid
        function createPhotoGrid() {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = '';
            
            if (filteredPhotos.length === 0) {
                showErrorMessage(`No images found${currentFilter !== 'all' ? ` for category: ${currentFilter}` : ' in the gallery'}.`);
                return;
            }
            
            filteredPhotos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                photoItem.dataset.id = photo.id;
                photoItem.dataset.categories = JSON.stringify(photo.categories || []);
                
                // No need for grid positioning - CSS masonry handles layout
                
                photoItem.innerHTML = `
                    <img src="${photo.src}" 
                         alt="${photo.title}" 
                         loading="lazy"
                         onerror="this.parentElement.style.display='none';">
                    <div class="photo-overlay">
                        <div class="photo-overlay-title">${photo.title}</div>
                        <div class="photo-overlay-caption">${photo.caption}</div>
                        <div class="photo-overlay-meta">${formatMetadata(photo.metadata)}</div>
                    </div>
                `;
                
                photoItem.addEventListener('click', () => {
                    // Find the index in the original photos array for lightbox navigation
                    const originalIndex = photos.findIndex(p => p.id === photo.id);
                    openLightbox(originalIndex);
                });
                grid.appendChild(photoItem);
            });
        }

        // Format metadata for display
        function formatMetadata(metadata) {
            if (!metadata || Object.keys(metadata).length === 0) return '';
            
            const parts = [];
            if (metadata.camera) parts.push(metadata.camera);
            if (metadata.lens) parts.push(metadata.lens);
            if (metadata.settings) parts.push(metadata.settings);
            
            return parts.join(' • ');
        }

        // Show error message
        function showErrorMessage(message) {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = `<div class="error-message">${message}</div>`;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Lightbox controls
            document.getElementById('closeBtn').addEventListener('click', closeLightbox);
            document.getElementById('prevBtn').addEventListener('click', () => navigateImage(-1));
            document.getElementById('nextBtn').addEventListener('click', () => navigateImage(1));
            
            // Keyboard navigation
            document.addEventListener('keydown', handleKeyPress);
            
            // Click outside to close
            document.getElementById('lightbox').addEventListener('click', (e) => {
                if (e.target.id === 'lightbox') closeLightbox();
            });
        }

        // Lightbox functions
        function openLightbox(index) {
            
            currentImageIndex = index;
            isLightboxOpen = true;
            
            const lightbox = document.getElementById('lightbox');
            lightbox.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            setTimeout(() => {
                lightbox.classList.add('active');
                loadImage(index);
            }, 10);
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            isLightboxOpen = false;
            
            setTimeout(() => {
                lightbox.style.display = 'none';
                document.body.style.overflow = 'auto';
            }, 300);
        }

        function loadImage(index) {
            const photo = photos[index];
            if (!photo) return;
            
            const img = document.getElementById('lightboxImage');
            
            // Set image immediately to see if it appears
            img.src = photo.src;
            img.alt = photo.title;
            img.style.opacity = '1';
            
            // Update info
            updateImageInfo(photo, index);
            
            // Also try with new Image loading for proper error handling
            const newImg = new Image();
            newImg.onload = () => {
            };
            
            newImg.onerror = () => {
                console.error('Failed to load image:', photo.src);
                img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gIDxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjZGRkIi8+ICA8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIG5vdCBmb3VuZDwvdGV4dD48L3N2Zz4=';
            };
            
            newImg.src = photo.src;
        }

        function updateImageInfo(photo, index) {
            document.getElementById('imageTitle').textContent = photo.title;
            document.getElementById('imageCaption').textContent = photo.caption;
            document.getElementById('imageMetadata').textContent = formatMetadata(photo.metadata);
        }

        function navigateImage(direction) {
            currentImageIndex += direction;
            
            if (currentImageIndex < 0) {
                currentImageIndex = photos.length - 1;
            } else if (currentImageIndex >= photos.length) {
                currentImageIndex = 0;
            }
            
            loadImage(currentImageIndex);
        }



        function handleKeyPress(e) {
            if (!isLightboxOpen) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    navigateImage(-1);
                    break;
                case 'ArrowRight':
                    navigateImage(1);
                    break;
                case 'Escape':
                    closeLightbox();
                    break;
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initGallery);
    </script>

    <!-- Mobile Navigation Script -->
    <script src="mobile-nav.js"></script>
</body>
</html>