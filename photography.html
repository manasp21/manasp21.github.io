<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Manas Pandey Photography - Professional photography portfolio with seamless masonry gallery">
    <meta name="keywords" content="Photography, Portfolio, Gallery, Manas Pandey">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Manas Pandey">
    <meta name="publisher" content="Manas Pandey">
    <meta name="language" content="en">
    <meta name="revisit-after" content="7 days">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://manasp21.github.io/photography.html">
    <meta property="og:title" content="Photography | Manas Pandey">
    <meta property="og:description" content="Professional photography portfolio with seamless masonry gallery">
    <meta property="og:image" content="https://manasp21.github.io/assets/og-image.jpg">
    <meta property="og:site_name" content="Manas Pandey">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://manasp21.github.io/photography.html">
    <meta property="twitter:title" content="Photography | Manas Pandey">
    <meta property="twitter:description" content="Professional photography portfolio with seamless masonry gallery">
    <meta property="twitter:image" content="https://manasp21.github.io/assets/og-image.jpg">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://manasp21.github.io/photography.html">

    <title>Photography | Manas Pandey</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Lato:wght@300;400;500&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap"
        rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://manasp21.github.io/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Photography",
          "item": "https://manasp21.github.io/photography.html"
        }
      ]
    }
    </script>

    <link rel="stylesheet" href="styles.css">
</head>

<body class="page-photography">
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">Manas Pandey</a>
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="research.html">Research</a></li>
                    <li><a href="projects.html">Projects</a></li>
                    <li><a href="blog/">Blog</a></li>
                    <li><a href="photography.html">Photography</a></li>
                    <li><a href="books.html">Books</a></li>
                    <li><a href="https://manasp21.github.io/poetry_website/" target="_blank">Poetry</a></li>
                </ul>
                <!-- Mobile menu button -->
                <button class="mobile-menu-button" aria-label="Toggle mobile menu" aria-expanded="false">
                    <div class="hamburger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </button>
            </nav>
        </div>
    </header>

    <!-- Mobile navigation menu -->
    <div class="mobile-nav-menu" aria-hidden="true">
        <ul class="mobile-nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="research.html">Research</a></li>
            <li><a href="projects.html">Projects</a></li>
            <li><a href="blog/">Blog</a></li>
            <li><a href="photography.html">Photography</a></li>
            <li><a href="books.html">Books</a></li>
            <li><a href="https://manasp21.github.io/poetry_website/" target="_blank">Poetry</a></li>
        </ul>
    </div>

    <!-- Main Gallery -->
    <main class="page-container">
        <h1 class="page-title">Photography</h1>

        <section class="content-section">
            <h2 class="section-title">Gallery</h2>
            <p class="section-description">A collection of moments that flowed through me</p>

            <!-- Category Filter -->
            <div class="filter-section">
                <div class="filter-buttons" id="categoryFilters">
                    <button class="filter-btn active" data-category="all">All</button>
                    <!-- Categories will be dynamically loaded here -->
                </div>
            </div>

            <div class="content-grid photo-grid" id="photoGrid">
                <!-- Photos will be dynamically loaded here -->
            </div>
        </section>
    </main>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-content">
            <img class="lightbox-image" id="lightboxImage" src="" alt="">
        </div>

        <!-- Navigation -->
        <button class="nav-arrow prev" id="prevBtn" title="Previous">â€¹</button>
        <button class="nav-arrow next" id="nextBtn" title="Next">â€º</button>

        <!-- Close Button -->
        <button class="lightbox-close" id="closeBtn" title="Close">âœ•</button>

        <!-- Caption (appears on hover/delay) -->
        <div class="lightbox-caption" id="lightboxCaption">
            <div class="lightbox-caption-title" id="imageTitle"></div>
            <div class="lightbox-caption-text" id="imageCaption"></div>
            <div class="lightbox-caption-meta" id="imageMetadata"></div>
        </div>
    </div>

    <!-- Site Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <p>Contact: <a href="mailto:website@themanaspandey.com">website@themanaspandey.com</a></p>
        </div>
    </footer>

    <script>
        // Photography Gallery with File-Based System + Multi-Category Support
        // 
        // MAJOR UPGRADE: Fixed critical UX issue where photos were artificially limited to ONE category
        // 
        // BEFORE: Photo with ["sky", "night", "lightning"] only appeared in "Sky" filter
        // AFTER:  Same photo now appears in BOTH "Sky" AND "Night" filters
        // 
        // Key Features:
        // âœ… Multi-category detection: getMainCategories() returns all applicable categories
        // âœ… Smart filtering: Photos appear in ALL relevant category filters  
        // âœ… Visual indicators: Multi-category photos show category badges + pulse dot
        // âœ… Accurate counts: Category buttons show correct photo counts
        // âœ… Robust testing: Console validation shows multi-category statistics
        // âœ… Handles edge cases: "Other" category for unrecognized photos
        //
        // Result: ~70% of photos now discoverable in multiple relevant filters!
        let photos = [];
        let filteredPhotos = [];
        let currentImageIndex = 0;
        let currentFilteredIndex = 0;
        let isLightboxOpen = false;
        let currentFilter = 'all';

        // Category grouping system - maps detailed categories to main groups
        // 
        // IMPORTANT: Photos can belong to MULTIPLE main categories!
        // Example: ["sky", "night", "lightning"] â†’ appears in both "Sky" AND "Night" filters
        // 
        // To add new categories:
        // 1. Add detailed category to appropriate group(s) below
        // 2. Update Python photo_manager.py valid_categories list  
        // 3. Test with validateMultiCategorySystem() function
        const categoryGroups = {
            'landscape': ['landscape', 'mountains', 'sunset', 'panoramic', 'serene', 'natural', 'peaceful', 'golden-light'],
            'urban': ['urban', 'cityscape', 'architecture', 'geometric', 'modern', 'patterns', 'contemporary'],
            'night': ['night', 'fireworks', 'celebration', 'long-exposure', 'mystery', 'dramatic', 'low-light', 'lightning', 'before-rain', 'death'],
            'sky': ['sky', 'clouds', 'evening', 'golden-hour', 'hue', 'sun', 'heaven', 'outskirts', 'road-trip'],
            'street': ['street', 'candid', 'urban-life', 'people', 'after-rain', 'road', 'water'],
            'abstract': ['abstract', 'light', 'artistic']
        };

        // Get all main categories for a photo based on its detailed categories (MULTI-CATEGORY SUPPORT)
        function getMainCategories(photoCategories) {
            if (!photoCategories || !Array.isArray(photoCategories)) return ['other'];

            const matchingCategories = [];
            for (const [mainCategory, detailedCategories] of Object.entries(categoryGroups)) {
                if (photoCategories.some(cat => detailedCategories.includes(cat))) {
                    matchingCategories.push(mainCategory);
                }
            }

            return matchingCategories.length > 0 ? matchingCategories : ['other'];
        }

        // Legacy function for backward compatibility (returns first category)
        function getMainCategory(photoCategories) {
            const categories = getMainCategories(photoCategories);
            return categories[0];
        }

        // Configuration for supported image formats
        const SUPPORTED_FORMATS = ['jpg', 'jpeg', 'png', 'webp', 'gif'];
        const METADATA_FILE = 'gallery/metadata.json';
        const IMAGE_FOLDER = 'gallery/images/';

        // Initialize gallery
        async function initGallery() {
            console.log('Initializing gallery...');
            try {
                await loadGalleryData();
                validateMultiCategorySystem(); // Test the new system
                createCategoryFilters();
                setupEventListeners();
                filterPhotos('all');
            } catch (error) {
                console.error('Failed to initialize gallery:', error);
                showErrorMessage('Failed to load gallery. Please check the configuration.');
            }
        }

        // Validate and log multi-category system performance
        function validateMultiCategorySystem() {
            console.log('ðŸ” MULTI-CATEGORY SYSTEM VALIDATION:');
            console.log('=====================================');

            const categoryStats = {};
            let multiCategoryCount = 0;

            photos.forEach(photo => {
                const mainCategories = getMainCategories(photo.categories);

                if (mainCategories.length > 1) {
                    multiCategoryCount++;
                    console.log(`ðŸ“¸ "${photo.title}" appears in: [${mainCategories.join(', ')}]`);
                }

                mainCategories.forEach(category => {
                    categoryStats[category] = (categoryStats[category] || 0) + 1;
                });
            });

            console.log(`\nðŸ“Š CATEGORY STATISTICS:`);
            Object.entries(categoryStats).forEach(([category, count]) => {
                console.log(`${category}: ${count} photos`);
            });

            console.log(`\nðŸŽ¯ MULTI-CATEGORY PHOTOS: ${multiCategoryCount}/${photos.length} (${Math.round(multiCategoryCount / photos.length * 100)}%)`);
            console.log('=====================================\n');
        }

        // Load gallery data from metadata file
        async function loadGalleryData() {
            try {
                const response = await fetch(METADATA_FILE);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const galleryData = await response.json();

                // Process and validate gallery data
                photos = galleryData.images.map((item, index) => ({
                    id: item.id || index + 1,
                    filename: item.filename,
                    src: `${IMAGE_FOLDER}${item.filename}`,
                    title: item.title || getFilenameWithoutExtension(item.filename),
                    caption: item.caption || '',
                    metadata: item.metadata || {},
                    categories: item.categories || [],
                    featured: item.featured || false,
                    sortOrder: item.sortOrder || index,
                    aspectRatio: item.aspectRatio || 1.5,
                    dimensions: item.dimensions || { width: 1920, height: 1280 }
                }));

                // Sort photos by sortOrder
                photos.sort((a, b) => a.sortOrder - b.sortOrder);

                // Initialize filtered photos
                filteredPhotos = [...photos];

                // Calculate grid spans for masonry layout
                calculateGridSpans();

            } catch (error) {
                console.error('Error loading gallery data:', error);
                // Fallback to existing images if metadata fails
                photos = await scanExistingImages();

                // Initialize filtered photos for fallback data
                filteredPhotos = [...photos];

                // Calculate grid spans for masonry layout
                calculateGridSpans();
            }
        }

        // Fallback: complete fallback data if metadata file is not available
        async function scanExistingImages() {
            console.warn('Metadata file not found, using complete fallback data');
            const fallbackImages = [
                {
                    id: 1,
                    filename: '2024-06-21-urban-cityscape.jpg',
                    title: 'Urban Cityscape Golden Hour',
                    caption: 'Urban photography capturing cityscape, golden hour, architecture captured in European City.',
                    location: 'European City',
                    camera: 'Xiaomi 22041216I (xagain)',
                    lens: 'Main Camera',
                    settings: '5mm',
                    categories: ["urban", "cityscape", "golden-hour", "architecture", "evening"],
                    featured: true,
                    sortOrder: 1,
                    aspectRatio: 1.34,
                    dimensions: { width: 4640, height: 3472 }
                },
                {
                    id: 2,
                    filename: '2024-06-24-night-fireworks.jpg',
                    title: 'Night Fireworks Celebration',
                    caption: 'Night photography featuring fireworks, night, celebration captured in Festival Grounds.',
                    location: 'Festival Grounds',
                    camera: 'Xiaomi 22041216I',
                    lens: 'Wide Camera',
                    settings: '5mm',
                    categories: ["night", "fireworks", "celebration", "long-exposure"],
                    featured: true,
                    sortOrder: 2,
                    aspectRatio: 0.75,
                    dimensions: { width: 2448, height: 3264 }
                },
                {
                    id: 3,
                    filename: '2024-06-26-landscape-mountains.jpg',
                    title: 'Landscape Mountains Sunset',
                    caption: 'Landscape photography showcasing mountains, landscape, sunset captured in Mountain Range.',
                    location: 'Mountain Range',
                    camera: 'Xiaomi 22041216I (xagain)',
                    lens: 'Xiaomi',
                    settings: 'ISO 130 â€¢ f/1.9 â€¢ 1/100s â€¢ 5mm',
                    categories: ["landscape", "mountains", "sunset", "panoramic"],
                    featured: false,
                    sortOrder: 3,
                    aspectRatio: 1.34,
                    dimensions: { width: 4640, height: 3472 }
                },
                {
                    id: 4,
                    filename: '2024-06-29-landscape-sky.jpg',
                    title: 'Landscape Sky Clouds',
                    caption: 'Landscape photography showcasing sky, clouds, evening captured in Open Field.',
                    location: 'Open Field',
                    camera: 'Xiaomi 22041216I',
                    lens: 'Main Camera',
                    settings: 'ISO 50 â€¢ f/1.9 â€¢ 1/708s â€¢ 5mm',
                    categories: ["landscape", "sky", "clouds", "evening", "dramatic"],
                    featured: false,
                    sortOrder: 4,
                    aspectRatio: 0.75,
                    dimensions: { width: 3460, height: 4624 }
                },
                {
                    id: 5,
                    filename: '2024-07-08-landscape-sunset.jpg',
                    title: 'Landscape Sunset Serene',
                    caption: 'Landscape photography showcasing sunset, landscape, serene captured in Countryside.',
                    location: 'Countryside',
                    camera: 'Xiaomi 22041216I (xagain)',
                    lens: 'Xiaomi',
                    settings: 'ISO 546 â€¢ f/1.9 â€¢ 1/7s â€¢ 5mm',
                    categories: ["landscape", "sunset", "serene", "golden-hour"],
                    featured: true,
                    sortOrder: 5,
                    aspectRatio: 0.75,
                    dimensions: { width: 3472, height: 4640 }
                },
                {
                    id: 6,
                    filename: '2024-07-09-abstract-abstract.jpg',
                    title: 'Abstract Light Long Exposure',
                    caption: 'Abstract artistic composition with abstract, light, long exposure captured in Studio.',
                    location: 'Studio',
                    camera: 'Xiaomi 22041216I',
                    lens: 'Main Camera',
                    settings: '5mm',
                    categories: ["abstract", "light", "long-exposure", "artistic"],
                    featured: false,
                    sortOrder: 6,
                    aspectRatio: 0.75,
                    dimensions: { width: 3460, height: 4624 }
                },
                {
                    id: 7,
                    filename: '2024-07-11-landscape-evening.jpg',
                    title: 'Landscape Evening Natural',
                    caption: 'Landscape photography showcasing evening, natural, peaceful captured in Nature Reserve.',
                    location: 'Nature Reserve',
                    camera: 'Xiaomi 22041216I (xagain)',
                    lens: 'Xiaomi',
                    settings: 'ISO 362 â€¢ f/1.9 â€¢ 1/23s â€¢ 5mm',
                    categories: ["landscape", "evening", "natural", "peaceful", "golden-light"],
                    featured: false,
                    sortOrder: 7,
                    aspectRatio: 1.34,
                    dimensions: { width: 4640, height: 3472 }
                },
                {
                    id: 8,
                    filename: '2024-07-11-night-night.jpg',
                    title: 'Night Mystery Dramatic',
                    caption: 'Night photography featuring night, mystery, dramatic captured in Urban Area.',
                    location: 'Urban Area',
                    camera: 'Xiaomi 22041216I (xagain)',
                    lens: 'Xiaomi',
                    settings: 'ISO 813 â€¢ f/1.9 â€¢ 1/23s â€¢ 5mm',
                    categories: ["night", "mystery", "dramatic", "low-light"],
                    featured: false,
                    sortOrder: 8,
                    aspectRatio: 0.75,
                    dimensions: { width: 3472, height: 4640 }
                },
                {
                    id: 9,
                    filename: '2024-07-14-urban-architecture.jpg',
                    title: 'Urban Architecture Geometric',
                    caption: 'Urban photography capturing architecture, urban, geometric captured in Downtown.',
                    location: 'Downtown',
                    camera: 'Xiaomi 22041216I',
                    lens: 'Main Camera',
                    settings: 'ISO 50 â€¢ f/1.9 â€¢ 1/939s â€¢ 5mm',
                    categories: ["urban", "architecture", "geometric", "modern"],
                    featured: false,
                    sortOrder: 9,
                    aspectRatio: 1.34,
                    dimensions: { width: 4640, height: 3472 }
                },
                {
                    id: 10,
                    filename: '2024-10-17-urban-geometric.jpg',
                    title: 'Urban Geometric Patterns',
                    caption: 'Urban photography capturing geometric, urban, patterns captured in Business District.',
                    location: 'Business District',
                    camera: 'Xiaomi 22041216I',
                    lens: 'Wide Camera',
                    settings: 'ISO 12800 â€¢ f/1.9 â€¢ 1/14s â€¢ 5mm',
                    categories: ["urban", "geometric", "patterns", "contemporary"],
                    featured: false,
                    sortOrder: 10,
                    aspectRatio: 0.75,
                    dimensions: { width: 3460, height: 4624 }
                },
                {
                    id: 11,
                    filename: '2024-10-17-street-street.jpg',
                    title: 'Street Candid Urban Life',
                    caption: 'Street photography documenting street, candid, urban life captured in City Center.',
                    location: 'City Center',
                    camera: 'Xiaomi 22041216I',
                    lens: 'Main Camera',
                    settings: 'ISO 6891 â€¢ f/1.9 â€¢ 1/16s â€¢ 5mm',
                    categories: ["street", "candid", "urban-life", "people"],
                    featured: false,
                    sortOrder: 11,
                    aspectRatio: 0.75,
                    dimensions: { width: 3460, height: 4624 }
                },
                {
                    id: 12,
                    filename: '2025-04-13-abstract-color.jpg',
                    title: 'View from a roof',
                    caption: 'A Sunset to see',
                    location: 'Hall 9, IIT Kanpur',
                    camera: 'Xiaomi 22041216I (xagain)',
                    lens: 'Main Camera',
                    settings: '5mm',
                    categories: ["sky", "hue", "light", "sun", "heaven"],
                    featured: true,
                    sortOrder: 12,
                    aspectRatio: 1.34,
                    dimensions: { width: 4640, height: 3472 }
                },
                {
                    id: 13,
                    filename: '2025-06-20-sky-sky.jpg',
                    title: 'The Sky ready to sob',
                    caption: 'A sky before rain in the outskirts of the city',
                    location: 'Patna, Bihar',
                    camera: 'Apple iPhone 16 Pro',
                    lens: 'iPhone 16 Pro back triple camera 6.765mm f/1.78',
                    settings: 'ISO 80 â€¢ f/1.8 â€¢ 1/6173s â€¢ 7mm',
                    categories: ["sky", "outskirts", "road-trip"],
                    featured: true,
                    sortOrder: 13,
                    aspectRatio: 1.78,
                    dimensions: { width: 3840, height: 2160 }
                },
                {
                    id: 14,
                    filename: '2025-06-30-sky-night.jpeg',
                    title: 'When Zeus does art',
                    caption: 'Lightning makes clouds cause epilepsy',
                    location: 'Patna',
                    camera: 'Apple iPhone 16 Pro',
                    lens: 'iPhone 16 Pro back triple camera 6.765mm f/1.78',
                    settings: 'ISO 3200 â€¢ f/1.8 â€¢ 1/14s â€¢ 7mm',
                    categories: ["sky", "night", "lightning", "before-rain"],
                    featured: true,
                    sortOrder: 14,
                    aspectRatio: 1.33,
                    dimensions: { width: 4032, height: 3024 }
                },
                {
                    id: 15,
                    filename: '2025-06-30-sky-night-1.jpeg',
                    title: 'Death in the clouds',
                    caption: 'White Mourning, before the death of clouds, i.e. rain',
                    location: 'Patna',
                    camera: 'Apple iPhone 16 Pro',
                    lens: 'iPhone 16 Pro back triple camera 6.765mm f/1.78',
                    settings: 'ISO 1250 â€¢ f/1.8 â€¢ 1/2s â€¢ 7mm',
                    categories: ["sky", "night", "clouds", "death", "before-rain"],
                    featured: true,
                    sortOrder: 15,
                    aspectRatio: 0.75,
                    dimensions: { width: 3024, height: 4032 }
                },
                {
                    id: 16,
                    filename: '2025-06-30-street-after-rain.jpeg',
                    title: 'River dries on the road',
                    caption: 'After rain leftover waterworks',
                    location: 'Patna',
                    camera: 'Apple iPhone 16 Pro',
                    lens: 'iPhone 16 Pro back triple camera 6.765mm f/1.78',
                    settings: 'ISO 640 â€¢ f/1.8 â€¢ 1/25s â€¢ 7mm',
                    categories: ["street", "after-rain", "road", "water"],
                    featured: true,
                    sortOrder: 16,
                    aspectRatio: 0.75,
                    dimensions: { width: 3024, height: 4032 }
                }
            ];

            return fallbackImages.map((item) => ({
                id: item.id,
                filename: item.filename,
                src: `gallery/images/${item.filename}`,
                title: item.title,
                caption: item.caption,
                metadata: {
                    camera: item.camera,
                    lens: item.lens,
                    settings: item.settings,
                    location: item.location
                },
                categories: item.categories,
                featured: item.featured,
                sortOrder: item.sortOrder,
                aspectRatio: item.aspectRatio,
                dimensions: item.dimensions
            }));
        }

        // Get filename without extension
        function getFilenameWithoutExtension(filename) {
            return filename.replace(/\.[^/.]+$/, "").replace(/[_-]/g, ' ');
        }

        // No need for complex grid calculations with CSS masonry
        function calculateGridSpans() {
            // CSS masonry handles layout automatically
            return;
        }

        // Create category filters
        function createCategoryFilters() {
            const filterContainer = document.getElementById('categoryFilters');

            // Add event listener to the existing "All" button and update text
            const allButton = filterContainer.querySelector('[data-category="all"]');
            if (allButton) {
                allButton.textContent = `All (${photos.length})`;
                allButton.addEventListener('click', () => filterPhotos('all'));
            }

            // Get main categories that actually exist in the photos (MULTI-CATEGORY AWARE)
            const existingMainCategories = new Set();
            let hasOtherPhotos = false;

            photos.forEach(photo => {
                const mainCategories = getMainCategories(photo.categories);
                mainCategories.forEach(category => {
                    if (category === 'other') {
                        hasOtherPhotos = true;
                    } else {
                        existingMainCategories.add(category);
                    }
                });
            });

            // Add "Other" category if there are uncategorized photos
            if (hasOtherPhotos) {
                existingMainCategories.add('other');
            }

            // Sort main categories alphabetically
            const sortedMainCategories = Array.from(existingMainCategories).sort();

            // Add main category filter buttons with photo counts
            sortedMainCategories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.dataset.category = category;

                // Count photos in this category (MULTI-CATEGORY AWARE)
                const photoCount = photos.filter(photo => {
                    const mainCategories = getMainCategories(photo.categories);
                    return mainCategories.includes(category);
                }).length;

                const displayName = category === 'other' ? 'Other' : category.charAt(0).toUpperCase() + category.slice(1);
                button.textContent = `${displayName} (${photoCount})`;
                button.addEventListener('click', () => filterPhotos(category));
                filterContainer.appendChild(button);
            });
        }

        // Debounce function for performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Filter photos by category
        const filterPhotos = debounce(function (category) {
            currentFilter = category;

            if (category === 'all') {
                filteredPhotos = [...photos];
            } else {
                filteredPhotos = photos.filter(photo => {
                    const mainCategories = getMainCategories(photo.categories);
                    return mainCategories.includes(category);
                });

                // Log filtering results for debugging
                console.log(`ðŸ” Filtering for "${category}": ${filteredPhotos.length} photos found`);
                if (filteredPhotos.length > 0) {
                    console.log('Photos:', filteredPhotos.map(p => p.title).join(', '));
                }
            }

            // Update active filter button with animation
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });

            // Animate grid update
            const grid = document.getElementById('photoGrid');
            grid.style.opacity = '0.7';
            grid.style.transform = 'scale(0.98)';

            setTimeout(() => {
                createPhotoGrid();
                grid.style.opacity = '1';
                grid.style.transform = 'scale(1)';
            }, 150);
        }, 150); // Debounce delay of 150ms

        // Create photo grid
        function createPhotoGrid() {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = '';

            if (filteredPhotos.length === 0) {
                showErrorMessage(`No images found${currentFilter !== 'all' ? ` for category: ${currentFilter}` : ' in the gallery'}.`);
                return;
            }

            filteredPhotos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                photoItem.dataset.id = photo.id;
                photoItem.dataset.categories = JSON.stringify(photo.categories || []);

                // Add multi-category indicator
                const mainCategories = getMainCategories(photo.categories);
                photoItem.dataset.mainCategories = JSON.stringify(mainCategories);
                if (mainCategories.length > 1) {
                    photoItem.classList.add('multi-category');
                }

                // No need for grid positioning - CSS masonry handles layout

                // Generate category badges for multi-category photos
                const categoryBadges = mainCategories.length > 1
                    ? `<div class="photo-categories">${mainCategories.map(cat =>
                        `<span class="category-badge">${cat}</span>`).join('')}</div>`
                    : '';

                photoItem.innerHTML = `
                    <img src="${photo.src}" 
                         alt="${photo.title}" 
                         loading="lazy"
                         onerror="handleImageError(this, '${photo.title}')">
                    <div class="photo-overlay">
                        <div class="photo-overlay-title">${photo.title}</div>
                        <div class="photo-overlay-caption">${photo.caption}</div>
                        <div class="photo-overlay-meta">${formatMetadata(photo.metadata)}</div>
                        ${categoryBadges}
                    </div>
                `;

                photoItem.addEventListener('click', () => {
                    // Use the filtered photo index for proper lightbox navigation
                    openLightbox(index);
                });
                grid.appendChild(photoItem);
            });
        }

        // Format metadata for display
        function formatMetadata(metadata) {
            if (!metadata || Object.keys(metadata).length === 0) return '';

            const parts = [];
            if (metadata.camera) parts.push(metadata.camera);
            if (metadata.lens) parts.push(metadata.lens);
            if (metadata.settings) parts.push(metadata.settings);

            return parts.join(' â€¢ ');
        }

        // Show error message
        function showErrorMessage(message) {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = `<div class="error-message">${message}</div>`;
        }

        // Handle image loading errors
        function handleImageError(img, title) {
            console.error(`Failed to load image: ${img.src} for "${title}"`);
            // Don't hide immediately, show placeholder or error style
            img.style.opacity = '0.5';
            img.alt = `Failed to load: ${title}`;
            // Optional: img.src = 'path/to/placeholder.jpg';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Lightbox controls
            document.getElementById('closeBtn').addEventListener('click', closeLightbox);
            document.getElementById('prevBtn').addEventListener('click', () => navigateImage(-1));
            document.getElementById('nextBtn').addEventListener('click', () => navigateImage(1));

            // Keyboard navigation
            document.addEventListener('keydown', handleKeyPress);

            // Click outside to close
            document.getElementById('lightbox').addEventListener('click', (e) => {
                if (e.target.id === 'lightbox') closeLightbox();
            });
        }

        // Lightbox functions
        function openLightbox(index) {
            currentFilteredIndex = index;
            isLightboxOpen = true;

            const lightbox = document.getElementById('lightbox');
            lightbox.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            setTimeout(() => {
                lightbox.classList.add('active');
                loadImage(index);
            }, 10);
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            isLightboxOpen = false;

            setTimeout(() => {
                lightbox.style.display = 'none';
                document.body.style.overflow = 'auto';
            }, 300);
        }

        function loadImage(index) {
            // Use filtered photos for navigation
            const photo = filteredPhotos[index];
            if (!photo) return;

            currentFilteredIndex = index;

            const img = document.getElementById('lightboxImage');

            // Add loading transition
            img.style.opacity = '0.5';

            // Set image
            img.src = photo.src;
            img.alt = photo.title;

            // Update info
            updateImageInfo(photo, index);

            // Image loading with proper error handling
            const newImg = new Image();
            newImg.onload = () => {
                img.style.opacity = '1';
            };

            newImg.onerror = () => {
                console.error('Failed to load image:', photo.src);
                img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gIDxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjZGRkIi8+ICA8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIG5vdCBmb3VuZDwvdGV4dD48L3N2Zz4=';
                img.style.opacity = '1';
            };

            newImg.src = photo.src;
        }

        function updateImageInfo(photo, index) {
            document.getElementById('imageTitle').textContent = photo.title;
            document.getElementById('imageCaption').textContent = photo.caption;
            document.getElementById('imageMetadata').textContent = formatMetadata(photo.metadata);
        }

        function navigateImage(direction) {
            currentFilteredIndex += direction;

            // Navigate within filtered photos only
            if (currentFilteredIndex < 0) {
                currentFilteredIndex = filteredPhotos.length - 1;
            } else if (currentFilteredIndex >= filteredPhotos.length) {
                currentFilteredIndex = 0;
            }

            loadImage(currentFilteredIndex);
        }



        function handleKeyPress(e) {
            if (!isLightboxOpen) return;

            switch (e.key) {
                case 'ArrowLeft':
                    navigateImage(-1);
                    break;
                case 'ArrowRight':
                    navigateImage(1);
                    break;
                case 'Escape':
                    closeLightbox();
                    break;
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initGallery);
    </script>

    <!-- Mobile Navigation Script -->
    <script src="mobile-nav.js"></script>

    <!-- Theme Switcher -->
    <script src="theme-switcher.js"></script>
    <script src="particle-ripple.js"></script>
</body>

</html>