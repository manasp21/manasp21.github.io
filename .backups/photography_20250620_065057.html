<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Manas Pandey Photography - Professional photography portfolio with seamless masonry gallery">
    <meta name="keywords" content="Photography, Portfolio, Gallery, Manas Pandey">
    <meta name="author" content="Manas Pandey">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://manasp21.github.io/photography.html">
    <meta property="og:title" content="Photography | Manas Pandey">
    <meta property="og:description" content="Professional photography portfolio with seamless masonry gallery">
    <meta property="og:image" content="https://manasp21.github.io/assets/og-image.jpg">
    <meta property="og:site_name" content="Manas Pandey">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://manasp21.github.io/photography.html">
    <meta property="twitter:title" content="Photography | Manas Pandey">
    <meta property="twitter:description" content="Professional photography portfolio with seamless masonry gallery">
    <meta property="twitter:image" content="https://manasp21.github.io/assets/og-image.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://manasp21.github.io/photography.html">
    
    <title>Photography | Manas Pandey</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Lato:wght@300;400;500&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://manasp21.github.io/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Photography",
          "item": "https://manasp21.github.io/photography.html"
        }
      ]
    }
    </script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body class="page-photography">
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">Manas Pandey</a>
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="research.html">Research</a></li>
                    <li><a href="projects.html">Projects</a></li>
                    <li><a href="blog/">Blog</a></li>
                    <li><a href="photography.html">Photography</a></li>
                    <li><a href="https://manasp21.github.io/poetry_website/" target="_blank">Poetry</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Gallery -->
    <main class="page-container">
        <h1 class="page-title">Photography</h1>
        <div class="photo-grid" id="photoGrid">
            <!-- Photos will be dynamically loaded here -->
        </div>
    </main>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <div class="lightbox-content">
            <img class="lightbox-image" id="lightboxImage" src="" alt="">
        </div>
        
        <!-- Navigation -->
        <button class="nav-arrow prev" id="prevBtn" title="Previous">‹</button>
        <button class="nav-arrow next" id="nextBtn" title="Next">›</button>
        
        <!-- Close Button -->
        <button class="lightbox-close" id="closeBtn" title="Close">✕</button>
        
        <!-- Caption (appears on hover/delay) -->
        <div class="lightbox-caption" id="lightboxCaption">
            <div class="lightbox-caption-title" id="imageTitle"></div>
            <div class="lightbox-caption-text" id="imageCaption"></div>
            <div class="lightbox-caption-meta" id="imageMetadata"></div>
        </div>
    </div>

    <script>
        // Photography Gallery with File-Based System
        let photos = [];
        let currentImageIndex = 0;
        let isLightboxOpen = false;

        // Configuration for supported image formats
        const SUPPORTED_FORMATS = ['jpg', 'jpeg', 'png', 'webp', 'gif'];
        const METADATA_FILE = 'gallery/metadata.json';
        const IMAGE_FOLDER = 'gallery/images/';

        // Initialize gallery
        async function initGallery() {
            try {
                await loadGalleryData();
                setupEventListeners();
                createPhotoGrid();
            } catch (error) {
                console.error('Failed to initialize gallery:', error);
                showErrorMessage('Failed to load gallery. Please check the configuration.');
            }
        }

        // Load gallery data from metadata file
        async function loadGalleryData() {
            try {
                console.log('Loading metadata from:', METADATA_FILE);
                const response = await fetch(METADATA_FILE);
                console.log('Response status:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const galleryData = await response.json();
                
                // Process and validate gallery data
                photos = galleryData.images.map((item, index) => ({
                    id: item.id || index + 1,
                    filename: item.filename,
                    src: `${IMAGE_FOLDER}${item.filename}`,
                    title: item.title || getFilenameWithoutExtension(item.filename),
                    caption: item.caption || '',
                    metadata: item.metadata || {},
                    tags: item.tags || [],
                    category: item.category || 'general',
                    featured: item.featured || false,
                    sortOrder: item.sortOrder || index,
                    aspectRatio: item.aspectRatio || 1.5,
                    dimensions: item.dimensions || { width: 1920, height: 1280 }
                }));

                // Sort photos by sortOrder
                photos.sort((a, b) => a.sortOrder - b.sortOrder);

                // Calculate grid spans for masonry layout
                calculateGridSpans();

            } catch (error) {
                console.error('Error loading gallery data:', error);
                console.log('Falling back to hardcoded images');
                // Fallback to existing images if metadata fails
                photos = await scanExistingImages();
            }
        }

        // Fallback: scan existing images if metadata file is not available
        async function scanExistingImages() {
            const fallbackImages = [
                '2024-06-21-urban-cityscape.jpg',
                '2024-06-24-night-fireworks.jpg',
                '2024-06-26-landscape-mountains.jpg',
                '2024-06-29-landscape-sky.jpg',
                '2024-07-08-landscape-sunset.jpg',
                '2024-07-09-abstract-abstract.jpg',
                '2024-07-11-landscape-evening.jpg',
                '2024-07-11-nature-nature.jpg',
                '2024-07-11-night-night.jpg',
                '2024-07-14-urban-architecture.jpg',
                '2024-10-17-urban-geometric.jpg',
                '2024-10-17-street-street.jpg',
                '2024-10-17-urban-modern.jpg',
                '2025-04-13-abstract-color.jpg',
                '2024-07-03-abstract-experimental.jpg',
                '2024-07-09-abstract-artistic.jpg'
            ];

            return fallbackImages.map((filename, index) => ({
                id: index + 1,
                filename: filename,
                src: `gallery/images/${filename}`,
                title: `Image ${index + 1}`,
                caption: 'Image Caption',
                metadata: { camera: 'Unknown', lens: 'Unknown', settings: 'Unknown' },
                tags: ['photography'],
                category: 'general',
                featured: false,
                sortOrder: index,
                aspectRatio: 1.5,
                dimensions: { width: 1920, height: 1280 }
            }));
        }

        // Get filename without extension
        function getFilenameWithoutExtension(filename) {
            return filename.replace(/\.[^/.]+$/, "").replace(/[_-]/g, ' ');
        }

        // No need for complex grid calculations with CSS masonry
        function calculateGridSpans() {
            // CSS masonry handles layout automatically
            return;
        }

        // Create photo grid
        function createPhotoGrid() {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = '';
            
            if (photos.length === 0) {
                showErrorMessage('No images found in the gallery.');
                return;
            }
            
            photos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                photoItem.dataset.id = photo.id;
                photoItem.dataset.category = photo.category;
                
                // No need for grid positioning - CSS masonry handles layout
                
                photoItem.innerHTML = `
                    <img src="${photo.src}" 
                         alt="${photo.title}" 
                         loading="lazy"
                         onerror="this.parentElement.style.display='none';">
                    <div class="photo-overlay">
                        <div class="photo-overlay-title">${photo.title}</div>
                        <div class="photo-overlay-caption">${photo.caption}</div>
                        <div class="photo-overlay-meta">${formatMetadata(photo.metadata)}</div>
                    </div>
                `;
                
                photoItem.addEventListener('click', () => {
                    console.log('Photo clicked, index:', index);
                    openLightbox(index);
                });
                grid.appendChild(photoItem);
            });
        }

        // Format metadata for display
        function formatMetadata(metadata) {
            if (!metadata || Object.keys(metadata).length === 0) return '';
            
            const parts = [];
            if (metadata.camera) parts.push(metadata.camera);
            if (metadata.lens) parts.push(metadata.lens);
            if (metadata.settings) parts.push(metadata.settings);
            
            return parts.join(' • ');
        }

        // Show error message
        function showErrorMessage(message) {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = `<div class="error-message">${message}</div>`;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Lightbox controls
            document.getElementById('closeBtn').addEventListener('click', closeLightbox);
            document.getElementById('prevBtn').addEventListener('click', () => navigateImage(-1));
            document.getElementById('nextBtn').addEventListener('click', () => navigateImage(1));
            
            // Keyboard navigation
            document.addEventListener('keydown', handleKeyPress);
            
            // Click outside to close
            document.getElementById('lightbox').addEventListener('click', (e) => {
                if (e.target.id === 'lightbox') closeLightbox();
            });
        }

        // Lightbox functions
        function openLightbox(index) {
            console.log('Opening lightbox for index:', index);
            console.log('Photo data:', photos[index]);
            
            currentImageIndex = index;
            isLightboxOpen = true;
            
            const lightbox = document.getElementById('lightbox');
            lightbox.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            setTimeout(() => {
                lightbox.classList.add('active');
                loadImage(index);
            }, 10);
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            isLightboxOpen = false;
            
            setTimeout(() => {
                lightbox.style.display = 'none';
                document.body.style.overflow = 'auto';
            }, 300);
        }

        function loadImage(index) {
            const photo = photos[index];
            const img = document.getElementById('lightboxImage');
            
            console.log('Loading image:', photo.src);
            
            // Set image immediately to see if it appears
            img.src = photo.src;
            img.alt = photo.title;
            img.style.opacity = '1';
            
            // Update info
            updateImageInfo(photo, index);
            
            // Also try with new Image loading for proper error handling
            const newImg = new Image();
            newImg.onload = () => {
                console.log('Image loaded successfully:', photo.src);
            };
            
            newImg.onerror = () => {
                console.error('Failed to load image:', photo.src);
                img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gIDxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjZGRkIi8+ICA8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIG5vdCBmb3VuZDwvdGV4dD48L3N2Zz4=';
            };
            
            newImg.src = photo.src;
        }

        function updateImageInfo(photo, index) {
            document.getElementById('imageTitle').textContent = photo.title;
            document.getElementById('imageCaption').textContent = photo.caption;
            document.getElementById('imageMetadata').textContent = formatMetadata(photo.metadata);
        }

        function navigateImage(direction) {
            currentImageIndex += direction;
            
            if (currentImageIndex < 0) {
                currentImageIndex = photos.length - 1;
            } else if (currentImageIndex >= photos.length) {
                currentImageIndex = 0;
            }
            
            loadImage(currentImageIndex);
        }



        function handleKeyPress(e) {
            if (!isLightboxOpen) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    navigateImage(-1);
                    break;
                case 'ArrowRight':
                    navigateImage(1);
                    break;
                case 'Escape':
                    closeLightbox();
                    break;
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initGallery);
    </script>
</body>
</html>